{% load static %}
{% include 'inc/head.inc.html' %}
{% include 'inc/navbar.inc.html' %}
{% load bootstrap4 %}
<body>
    <br>
    <div class="container">
        <div class="row">
            <div class="col-sm-8 justify-content-center text-center py-2 my-3">

                <div class="spinner-border text-info my-5 text-center" id="loading" role="status">
                    <span class="sr-only">Loading...</span>
                </div>

                <div id="map-container" style="width: 100%; height: 700px; border-radius: 10px; border: solid 2px grey; opacity: 0;">
                    <div id='map' style='width: 100%; height: 700px; border-radius: 10px;'></div>
                </div>
            </div>

            <div class="col-sm-4 py-2 my-3" >
                <div class="card text-center" style="width: 30%;position: fixed;height: 100%;padding-bottom: 60px!important;">
                    <div class="card-body text-left" style="overflow-y: scroll;width: 100%;height: 100%;padding-bottom: 60px!important;" >
                        <h3>Enter details</h3>
                        <form class="mt-3" method="POST" action="{% url 'index' %}">
                        {% csrf_token %}
                            {% bootstrap_form userform %}
                            {% bootstrap_form service_type %}
                            {% bootstrap_form geoInfo %}
{#                            <div class="form-group">#}
{#                                <label for="exampleSelect">Service type</label>#}
{#                                <select class="form-control" id="exampleSelect">#}
{#                                    <option value="">Alarm system</option>#}
{#                                    {% for service in services %}#}
{#                                        <option value="">Alarm system</option>#}
{#                                    {% endfor %}#}
{#                                </select>#}
{#                            </div>#}
{##}
{#                            <div class="form-group">#}
{#                                <label class="my-0">Place info</label>#}
{#                                <div class="field" style="width: 100%; height: auto; padding: 0px;">#}
{#                                    <div class="row">#}
{#                                        <div class="col-sm-6">#}
{#                                            <input type="text" class="form-control" style="border: none; background-color: #ffffff;" name="lat" id="lat" aria-describedby="emailHelp" disabled>#}
{#                                        </div>#}
{#                                        <div class="col-sm-6">#}
{#                                            <input type="text" class="form-control" style="border: none; background-color: #ffffff" name="lang" id="lang" aria-describedby="emailHelp" disabled>#}
{#                                        </div>#}
{##}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{##}
{##}
{##}
{##}
{#                            <div class="form-group">#}
{#                                <label for="exampleInputEmail1">Email address</label>#}
{#                                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">#}
{#                                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>#}
{#                            </div>#}
{#                            <div class="form-group">#}
{#                                <label for="exampleInputPassword1">Password</label>#}
{#                                <input type="password" class="form-control" id="exampleInputPassword1">#}
{#                            </div>#}
{#                            <div class="form-group form-check">#}
{#                                <input type="checkbox" class="form-check-input" id="exampleCheck1">#}
{#                                <label class="form-check-label" for="exampleCheck1">Check me out</label>#}
{#                            </div>#}
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>

                    </div>
<!--
                    <hr class="my-0">
                    <div class="m-0">
                        <div class="py-2" style="display: inline-block; width: 33.3%;">
                            Ongoing
                        </div>
                        <div class="py-2" style="display: inline-block; width: 30%;">
                            Completed
                        </div>
                        <div class="py-2" style="display: inline-block; width: 33.3%;">
                            Late
                        </div>
                    </div>
                    <div class="text-left px-4" id="task-container">
                        <div class="my-2">Task 1</div>
                        <div class="my-2">Task 2</div>
                        <div class="my-2">Task 3</div>
                        <div class="my-2">Task 4</div>
                        <div class="my-2">Task 5</div>
                    </div> -->

                </div>


            </div>


        </div>

    </div>



</body>


<script>
        var map_container = []

        mapboxgl.accessToken = 'pk.eyJ1IjoibWFhemhhc3NhbiIsImEiOiJja2QybmJkOTkxZmQwMnhxeWQ3bTRseTUwIn0.O635_fQIQv7h--atZBrb_g';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/outdoors-v11',
            // style: 'mapbox://styles/mapbox/streets-v11',
            center: [16.2705769, 62.8735285], // starting position
            zoom: 4 // starting zoom
        });

        map.addControl(new mapboxgl.NavigationControl());


        setTimeout(function(){
            $("#loading").css('display', 'none');
            $("#map-container").css('opacity', '1');
        }, 2000);

        function setMarkerColor(marker, color) {
            var $elem = jQuery(marker.getElement());
            $elem.find('svg g[fill="' + marker._color + '"]').attr('fill', color);
            marker._color = color;
        }

        map.on('click', function(e) {


            if (map_container.length > 0) {

                for (let i = 0; i < map_container.length; i++) {
                    let element = map_container[i];
                    // console.log(element);
                    element.remove()
                }
            }

            console.log(e.lngLat);
            var my_point = e.lngLat;

            var marker = new mapboxgl.Marker()
                .setLngLat([my_point.lng, my_point.lat])
                .addTo(map);

            // setMarkerColor(marker, "#154fa1");

            $("#id_service_installation_place").val('Longitude: '+my_point.lng+', latitude: '+my_point.lat);

            map_container.push(marker);
        });

        const install_date = document.getElementById('id_installation_date');
        const next_S_date = document.getElementById('id_next_service_date');
        install_date.setAttribute('type','datetime-local');
        next_S_date.setAttribute('type','datetime-local')
</script>


</html>